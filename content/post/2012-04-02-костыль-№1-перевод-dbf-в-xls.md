---
title: –ö–æ—Å—Ç—ã–ª—å ‚Ññ1 –ü–µ—Ä–µ–≤–æ–¥ DBF –≤ XLS
author: Sclif
layout: post
date: 2012-04-02T16:04:30+00:00
categories:
  - –ö–æ—Å—Ç—ã–ª–∏
tags:
  - DBF
  - XLS

---
–†–µ—à–∏–ª –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º–∏ –∫–æ—Å—Ç—ã–ª—è–º–∏ üôÇ –û—á–µ–Ω—å —á–∞—Å—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å—Å—è –ø–∏—Å–∞—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∫–∏ (–∫–æ—Å—Ç—ã–ª–∏), –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∫–∞–∫—É—é-—Ç–æ —Ä—É—Ç–∏–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É.

–ò —Ç–∞–∫ –∫–æ—Å—Ç—ã–ª—å ‚Ññ1. –ü–æ—è–≤–∏–ª–∞—Å—å –∑–∞–¥–∞—á–∞ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –∫—É—á—É dbf —Ñ–∞–π–ª–æ–≤ –≤ xls —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º. –ö–æ–Ω–µ—á–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–∫–æ–¥–∏—Ä—É—é—Ç dbf –≤ xls, –Ω–æ –æ–Ω–∏ –ø–ª–∞—Ç–Ω—ã–µ –∏ –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞. –ü–æ—ç—Ç–æ–º—É –≤—ã–±–æ—Ä –º–æ–π –ø–∞–ª –Ω–∞ Open Office –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Basic.

–î–∞–Ω–Ω—ã–π –º–∞–∫—Ä–æ—Å –±–µ—Ä–µ—Ç —Ñ–∞–π–ª—ã dbf –∏–∑ –ø–∞–ø–∫–∏ C:\TEMP\detail\ –∏ –∫–ª–∞–¥–µ—Ç XLS –≤ C:\TEMP\detail\XLS\ . –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–≤–æ–∏ –ø—É—Ç–∏.

```
Sub Main

Dim NextFile As String
NextFile = Dir("C:\TEMP\detail\*.dbf", 0)

While NextFile &lt;&gt; ""

cDbfFileToOpen = "C:\TEMP\detail\" + NextFile
cXlsFileToSave = "C:\TEMP\detail\XLS\" + NextFile
ResultString = InStr(1, cXlsFileToSave, "dbf")
Mid(cXlsFileToSave, ResultString, 3, "XLS")

'–û—Ç–∫—Ä—ã–≤–∞–µ–º DBF
cURLDBF = ConvertToURL( cDbfFileToOpen )
oCalcDoc = StarDesktop.loadComponentFromURL( cURLDBF, "_blank", 0, _
Array( MakePropertyValue( "FilterName", "dBase" ),_
MakePropertyValue( "FilterOptions", "30" )) )

'–£–¥–∞–ª—è–µ–º 2 –ø–µ—Ä–≤—ã—Ö —Å—Ç–æ–ª–±—Ü–∞
Sheet = oCalcDoc.Sheets(0)
Sheet.Columns.removeByIndex(0, 2)

'–£–¥–∞–ª—è–µ–º –µ—â–µ 4 —Å—Ç–æ–ª–±—Ü–∞
Sheet.Columns.removeByIndex(1, 2)
Sheet.Columns.removeByIndex(3, 1)
Sheet.Columns.removeByIndex(6, 1)

'–ò–∑–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç —Å—Ç–æ–ª–±—Ü–æ–≤ 7 –∏ 8
Dim NumberFormats As Object
Dim NumberFormatString As String
Dim NumberFormatId As Long
Dim LocalSettings As New com.sun.star.lang.Locale

LocalSettings.Language = "ru"
LocalSettings.Country = "ru"

NumberFormats = oCalcDoc.NumberFormats
NumberFormatString = "# ##0,00 [$—Ä—É–±.-419];[RED]-# ##0,00 [$—Ä—É–±.-419]"

NumberFormatId = NumberFormats.addNew(NumberFormatString, LocalSettings)

Col = Sheet.Columns(7)
Col.NumberFormat = NumberFormatId
Col.OptimalWidth = True
'–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É
Col.HoriJustify = com.sun.star.table.CellHoriJustify.CENTER

Col = Sheet.Columns(8)
Col.NumberFormat = NumberFormatId
Col.OptimalWidth = True

'–ò–∑–º–µ–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤
Cell = Sheet.getCellByPosition(0, 0)
Cell.String = "–ü–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü"

Cell = Sheet.getCellByPosition(1, 0)
Cell.String = "–í—Ç–æ—Ä–æ–π"

Cell = Sheet.getCellByPosition(2, 0)
Cell.String = "–¢—Ä–µ—Ç–∏–π"

Cell = Sheet.getCellByPosition(3, 0)
Cell.String = "–ß–µ—Ç–≤–µ—Ä—Ç—ã–π"

Cell = Sheet.getCellByPosition(4, 0)
Cell.String = "–ü—è—Ç—ã–π"

Cell = Sheet.getCellByPosition(5, 0)
Cell.String = "–®–µ—Å—Ç–æ–π"

Cell = Sheet.getCellByPosition(6, 0)
Cell.String = "–°–µ–¥—å–º–æ–π"

Cell = Sheet.getCellByPosition(7, 0)
Cell.String = "–í–æ—Å—å–º–æ–π"

'–í—ã—Å—Ç–∞–≤–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É —Å—Ç–æ–ª–±—Ü–æ–≤
For I = 0 To 7
Col = Sheet.Columns(I)
Col.OptimalWidth = True
Next I

Col = Sheet.Columns(2)
Col.Width = 5000

'–°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ XLS
cURLXLS = ConvertToURL( cXlsFileToSave )
oCalcDoc.storeToURL( cURLXLS, _
Array( MakePropertyValue( "FilterName", "MS Excel 97" ) ) )

oCalcDoc.close( True )

NextFile = Dir
Wend

End Sub

Function MakePropertyValue( Optional cName As String, Optional uValue ) As com.sun.star.beans.PropertyValue
Dim oPropertyValue As New com.sun.star.beans.PropertyValue
If Not IsMissing( cName ) Then
oPropertyValue.Name = cName
EndIf
If Not IsMissing( uValue ) Then
oPropertyValue.Value = uValue
EndIf
MakePropertyValue() = oPropertyValue
End Function
```